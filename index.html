<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperVerge KYC Blockchain Demo</title>
    <script
        src="https://hv-camera-web-sg.s3-ap-southeast-1.amazonaws.com/hyperverge-web-sdk@9.15.2/src/sdk.min.js"></script>
    <style>
        @import "style.css";
    </style>
</head>

<body>
    <h2>HyperVerge KYC Blockchain Demo</h2>
    <div>
        <button type="button" onclick="startOnboarding();">
            Start KYC Onboarding
        </button>
    </div>
    <div id="result">KYC Result will appear here...</div>
    <script>
        // Mock blockchain ledger for demo purposes
        const mockBlockchainLedger = [];

        function addToBlockchain(transactionId, kycResult) {
            const timestamp = new Date().toISOString();
            const block = {
                transactionId,
                kycResult,
                timestamp,
                hash: btoa(transactionId + timestamp) // Simple base64 hash for demo
            };
            mockBlockchainLedger.push(block);
            return block;
        }

        function displayResult(message, block = null) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            if (block) {
                resultDiv.innerHTML += `<br><strong>Blockchain Record:</strong><br>Transaction ID: ${block.transactionId}<br>Result: ${JSON.stringify(block.kycResult)}<br>Timestamp: ${block.timestamp}<br>Hash: ${block.hash}`;
            }
        }

        async function getAccessToken() {
            const response = await fetch('https://auth.hyperverge.co/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    appId: 'ct4wfd',
                    appKey: '424tdohz6d3hu7fj0u9l',
                    expiry: '4800',
                }),
            });
            const data = await response.json();
            const token = data.result.token;
            const formatedToken = token.replace("Bearer ", "");
            console.log("formatedToken", formatedToken);
            return formatedToken;
        }



        async function startOnboarding() {
            const accessToken = await getAccessToken();
            const hyperKycConfig = new HyperKycConfig(
                accessToken,
                "workflow_ekyc",
                "TX_1756365267835",
                true
            );
            console.log("hyperKycConfig", hyperKycConfig);
            HyperKYCModule.launch(hyperKycConfig, handler);
        }

        const handler = (HyperKycResult) => {
            if (HyperKycResult.Cancelled) {
                // user cancelled
                console.log(HyperKycResult.Cancelled);
            } else if (HyperKycResult.Failure) {
                // failure
                console.log(HyperKycResult.Failure);
            } else if (HyperKycResult.Success) {
                // success
                console.log(HyperKycResult.Success);
            }
        }
    </script>
</body>

</html>